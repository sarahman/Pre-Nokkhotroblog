<?php
/**
 * Group Type Controller
 *
 * @Group Type   Controller
 * @package     Admin
 * @author      Md. Sirajus Salayhin <salayhin@gmail.com>
 */

class Admin_BlogGroupsController extends Speed_Controller_ActionController
{
    public function indexAction()
    {
        $this->validateAdmin();
        $this->_helper->layout->setLayout('admin');
        $groupModel = new Admin_Model_BlogGroup();
        $display = $groupModel->getAll();		
        $this->view->display = $display;

    }

    public function editAction()
    {
        $this->validateAdmin();
        $this->_helper->layout->setLayout('admin');
        $groupModel = new Admin_Model_BlogGroup();
        $groupId = $this->_request->getParam('id');	
        $groupModel->getDetail($groupId);
        $groupTypeModel = new Admin_Model_BlogGroupType();
        $groupEntry = new Admin_Form_BlogGroupEntry(array(
            'blog_group_type_id' => $groupTypeModel->getAll(),
            'isEdit' => true,
            'blog_group_id' => $groupId
        ));

        if ($this->_request->isPost()) {
            $data = $this->_request->getParams();
            if ($groupEntry->isValid($data)) {		
                $result = $groupModel->modify($data, $data['blog_group_id']);
                if (empty($result)) {
                    $this->redirectForFailure('/admin/blog-groups/index','Problem , Please try again.');
                } else {
                    $this->redirectForSuccess('/admin/blog-groups/index','Group has been updated successfully.');
                }
            } else {
                $groupEntry->populate($data);	
            }
        } else {

            if (empty($groupId)) {		
                $this->redirectForFailure('/blog-groups/index','No Group found');
            } else {
                $groupModel = new Admin_Model_BlogGroup();
                $groupData = $groupModel->getDetail($groupId);	
                if (empty($groupData)) {		
                    $this->redirectForFailure('/blog-groups/index','No Group found.');
                } else {
                    $groupEntry->populate($groupData);	
                }
            }
        }
        $this->view->GroupEntry = $groupEntry;	

    }


    public function deleteAction()
    {
        $this->validateAdmin();
        $groupModel = new Admin_Model_BlogGroup();

        $groupId = $this->_request->getParam('id');	

        $status = $groupModel->delete($groupId);	

        if ($status) {
            $this->redirectForSuccess("/admin/blog-groups/index", "Group deleted Sucessfully.");
        } else {
            $this->redirectForFailure("/admin/blog-groups/index", "Something went wrong. Please try again");
        }
    }

    public function addAction()
    {
        $this->validateAdmin();
		$this->_helper->layout->setLayout('admin');
        $groupTypeModel = new Admin_Model_BlogGroupType();
        $groupEntry = new Admin_Form_BlogGroupEntry(array(
            'blog_group_type_id' => $groupTypeModel->getAll(),
            'isEdit' => false
        ));

        if ($this->_request->isPost()) {

            $data = $this->_request->getParams();
            $data['group_type'] = stripslashes($this->_request->getParam('group_type'));


            if ($groupEntry->isValid($data)) {

                $groupModel = new Admin_Model_BlogGroup();

                $result = $groupModel->save($data);
                if (empty($result)) {
                    $this->redirectForFailure('/admin/blog-groups/index','There was a problem , Please try again.');
                } else {

                    $this->redirectForSuccess('/admin/blog-groups/index','Group Type inserted sucessfully');
                }									

            } else {
                $groupEntry->populate($data);	
            }
        }

        $this->view->GroupEntry = $groupEntry;	

    }
    
    public function showAction()
    {
        $this->validateAdmin();
        $this->_helper->layout->setLayout('admin');

        $groupModel = new Admin_Model_BlogGroup();
        $groupId = $this->_request->getParam('id');

        $group = $groupModel->getDetailForAdmin($groupId);

        if (empty($group)) {
            $this->redirectForFailure("/admin/blog-groups", "Group has been deleted.");
        }

        $this->view->notice = $group;
    }
    
    public function publishAction()
    {
        $data = array();

        $this->disableLayout();

        $groupId = $this->_request->getParam('id');

        $authNamespace = new Zend_Session_Namespace('adminInformation');
        $adminId = $authNamespace->adminData['admin_id'];

        $groupModel = new Admin_Model_BlogGroup();
        $status = $groupModel->setPublishStatus($data, $groupId);

        if ($status) {
            $this->redirectForSuccess("/admin/blog-groups", "Group status updated");
        } else {
            $this->redirectForFailure("/admin/blog-groups", "Something went wrong");
        }

    }

}
